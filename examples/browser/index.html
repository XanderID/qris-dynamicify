<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QRIS Dynamicify - Browser Example</title>
    <script src="https://unpkg.com/qris-dynamicify@1.1.0/dist/browser/qris-dynamicify.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f8f9fa;
      }
      pre {
        background: #f1f3f5;
        padding: 10px;
        border-radius: 5px;
      }
      img {
        border: 1px solid #dee2e6;
        border-radius: 5px;
        max-width: 300px;
      }
    </style>
  </head>
  <body class="container py-5">
    <h1 class="mb-4 text-center">QRIS Dynamicify - Browser Example</h1>

    <!-- Input Section -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">Upload QRIS Image</h5>
        <p class="card-text">Select a QRIS image file to process.</p>
        <input
          type="file"
          class="form-control mb-3"
          id="qrisFileInput"
          accept="image/*"
        />

        <div class="row g-3">
          <div class="col-md-6">
            <label for="priceInput" class="form-label">Price (IDR)</label>
            <input
              type="number"
              class="form-control"
              id="priceInput"
              placeholder="Enter price"
              value="25000"
            />
          </div>
          <div class="col-md-6">
            <label for="taxInput" class="form-label">Tax (IDR)</label>
            <input
              type="number"
              class="form-control"
              id="taxInput"
              placeholder="Enter tax"
              value="30000"
            />
            <div class="form-text text-muted">
              Note: Not all providers support tax.
            </div>
          </div>
        </div>

        <button id="processBtn" class="btn btn-primary mt-3">
          Process QRIS
        </button>
      </div>
    </div>

    <!-- Output Section -->
    <div class="card shadow-sm">
      <div class="card-body" id="qrisResult">
        <p class="text-muted">Results will appear here after processing...</p>
      </div>
    </div>

    <script>
      let uploadedFile = null;

      document
        .getElementById("qrisFileInput")
        .addEventListener("change", (event) => {
          uploadedFile = event.target.files[0];
        });

      document
        .getElementById("processBtn")
        .addEventListener("click", async () => {
          const resultEl = document.getElementById("qrisResult");

          if (!uploadedFile) {
            resultEl.innerHTML =
              '<p class="text-danger">Please upload a QRIS image file first.</p>';
            return;
          }

          resultEl.innerHTML = "<p>Processing...</p>";

          try {
            const price = parseInt(
              document.getElementById("priceInput").value,
              10
            );
            const tax = parseInt(document.getElementById("taxInput").value, 10);

            const dynamicQris = await QrisDynamicify.fromFile(uploadedFile);
            const metadata = dynamicQris.getMetadata();

            // Update price & tax from inputs
            dynamicQris.setPrice(price).setTax(tax);

            const newMetadata = dynamicQris.getMetadata();

            // Generate new QR image (base64 data URL)
            const base64QR = await dynamicQris.writeToDataURL();

            // Display results
            resultEl.innerHTML = `
            <h5>Processing Result</h5>

            <p><strong>Original Metadata:</strong></p>
            <pre>${JSON.stringify(metadata, null, 2)}</pre>

            <p><strong>Updated Metadata:</strong></p>
            <pre>${JSON.stringify(newMetadata, null, 2)}</pre>

            <p><strong>Dynamic QRIS String:</strong></p>
            <pre>${dynamicQris.toString()}</pre>

            <p><strong>Generated QR Image:</strong></p>
            <img src="${base64QR}" alt="Generated QR" class="d-block mb-3" />

            <a href="${base64QR}" download="qris.png" class="btn btn-success">
              Download QR
            </a>
          `;
          } catch (error) {
            console.error("Error processing QRIS file:", error);
            resultEl.innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
          }
        });
    </script>
  </body>
</html>
